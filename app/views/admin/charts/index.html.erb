<% content_for :head do %>
<%= javascript_include_tag 'jquery.flot.min.js' %>
<% end %>

<%= render :partial => 'admin/shared/data_sub_menu' %>

<h1>数据统计图</h1>
<div>
	<div>
		<div id="monthly_chart" style="width:600px; height:300px; " align="left" >
		</div>
		<br />
	</div>
	<div >
		<label>公司名称：</label>
		<form method="post">
			<% @companies.each do |com| %>
			<input type="checkbox" id="<%= com.id%>">
			<%= com.name %>
			<br />
			<% end %>
			<button type="submit">添加</button>
		</form>
	</div>
	<div>
		渠道号查询(可模糊查询)：&nbsp;
		<form method="post">
		<input type="text" id="channel_query" /> <button type="submit">添加</button>
		</form>
	</div>
</div>
<h2>总数据量：&nbsp;<%= @total_count %></h2>
<script type="text/javascript">
$(function(){
var d1 = [<%= raw @query_data[0] %>
	];
	var plot = $.plot($("#monthly_chart"), [d1], {
		series: { lines: {show:true}, points: {show:true}},
		grid: { hoverable:true, clickable:true},
		xaxis: { mode: "time"}
	});

	function showToolTip(x,y,contents) {
		$('<div id="tooltip">' + contents + "</div>").css({
			position: 'absolute',
			display: 'none',
			top: y+5,
			left: x+5,
			border: '1px solid #fdd',
			padding: '2px',
			'background-color': '#fee',
			opacity: 0.80
		}).appendTo('body').fadeIn(200);
	}

	$("#monthly_chart").bind("plothover", function(event,pos,item) {
		if (item) {
			var x = item.datapoint[0],
			y = item.datapoint[1];
			showToolTip(item.pageX, item.pageY, y);
		} else {
			$("#tooltip").remove();
		}
	});
	$("#monthly_chart").bind("plotclick", function(event,pos,item) {
		if (item) {
			plot.highlight(item.series, item.datapoint);
		}
	});
	});
</script>
